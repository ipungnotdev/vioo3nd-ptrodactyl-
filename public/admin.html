<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1 style="text-align:center; margin:20px;">Admin Dashboard</h1>

<div style="max-width:900px; margin:0 auto;">
<h2>Panel Prices</h2>
<table border="1" cellpadding="10" cellspacing="0" width="100%">
<thead><tr><th>Paket</th><th>Harga</th><th>Action</th></tr></thead>
<tbody id="panelTable"></tbody>
</table>

<h2>Orders</h2>
<table border="1" cellpadding="10" cellspacing="0" width="100%">
<thead><tr><th>ID</th><th>Username</th><th>Paket</th><th>Harga</th><th>Created</th><th>Suspended</th></tr></thead>
<tbody id="ordersTable"></tbody>
</table>

<h2>Settings PLTA & QRIS</h2>
<div style="max-width:600px; margin-bottom:30px;">
    <label>Merchant ID Pakasir:</label><br>
    <input type="text" id="merchant_id"><br>
    <label>API Key Pakasir:</label><br>
    <input type="text" id="api_key"><br>
    <label>Domain Panel User:</label><br>
    <input type="text" id="domain_panel_user"><br>
    <label>PLTA Admin (Dashboard):</label><br>
    <input type="text" id="domain_plta_admin"><br><br>
    <button onclick="updateSettings()">Update Settings</button>
</div>
</div>

<script>
async function loadPanel(){
    const res = await fetch('/api/admin/panel-prices');
    const data = await res.json();
    const tbody = document.getElementById('panelTable');
    tbody.innerHTML='';
    for(let p in data.panelPrices){
        tbody.innerHTML+=`<tr>
        <td>${p}</td><td>${data.panelPrices[p]}</td>
        <td><input type="number" id="price_${p}" value="${data.panelPrices[p]}">
        <button onclick="updatePrice('${p}')">Update</button></td></tr>`;
    }
}
async function updatePrice(paket){
    const newPrice = document.getElementById(`price_${paket}`).value;
    await fetch('/api/admin/update-price',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({paket,newPrice})
    });
    alert('Price updated');
    loadPanel();
}

async function loadOrders(){
    const res = await fetch('/api/admin/orders');
    const data = await res.json();
    const tbody = document.getElementById('ordersTable');
    tbody.innerHTML='';
    data.orders.forEach(o=>{
        tbody.innerHTML+=`<tr>
        <td>${o.id}</td><td>${o.username}</td><td>${o.paket}</td>
        <td>${o.harga}</td><td>${new Date(o.createdAt).toLocaleString()}</td>
        <td>${o.suspended}</td></tr>`;
    });
}

async function loadSettings(){
    const res = await fetch('/api/admin/settings');
    const data = await res.json();
    document.getElementById('merchant_id').value = data.pakasir_merchant_id;
    document.getElementById('api_key').value = data.pakasir_api_key;
    document.getElementById('domain_panel_user').value = data.domain_panel_user;
    document.getElementById('domain_plta_admin').value = data.domain_plta_admin;
}
async function updateSettings(){
    const merchant_id = document.getElementById('merchant_id').value;
    const api_key = document.getElementById('api_key').value;
    const domain_panel_user = document.getElementById('domain_panel_user').value;
    const domain_plta_admin = document.getElementById('domain_plta_admin').value;

    await fetch('/api/admin/settings',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({merchant_id, api_key, domain_panel_user, domain_plta_admin})
    });
    alert('Settings updated!');
}

loadPanel();
loadOrders();
loadSettings();
setInterval(loadOrders,30000);
</script>
</body>
      </html>
